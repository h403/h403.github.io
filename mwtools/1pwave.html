<!DOCTYPE html>
<html>
	<head>
	<meta charset="utf-8">
	<title>sample</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="jquery.mobile-1.4.5.min.css" />
	<script src="jquery-2.1.4.min.js" type="text/javascript"></script>
	<script src="jquery.mobile-1.4.5.min.js" type="text/javascript"></script>
	<script src="jcanvas.min.js" type="text/javascript"></script>
	<script src="math.min.js" type="text/javascript"></script>
	</head>
	<body>
		<div data-role="page">
			<div data-role="header">
				<h1>header</h1>
			</div>
			<div role="main" class="ui-content">
				<canvas width="320" height="300"></canvas>
				<div>
					<label for='zr'>Z2</label>
					<input id='zr' type='range' min='-1' max='1' step='0.01' value='0'>
				</div>
			</div>
			<div data-role="footer">
				<h3>footer</h3>
			</div>
		</div>
	</body>
	<script>
		var k = math.chain(2).multiply(math.pi).divide(40.).done();
		var idx1 = math.range(0,-201,-1);
		var kx1 = math.chain(idx1)
			.multiply(k)
			.done();
		var idx2 = math.range(0,101);
		var kx2 = math.chain(idx2)
			.multiply(k)
			.done();
		/*
		var dat = math.chain(kx1)
			.cos()
			.multiply(50)
			.done();
		*/
		function lineObj(x,y,ox,oy,opt) {
			var obj = {
				strokeStyle: '#000',
				strokeWidth: 1,
				rounded: true
			};
			if (opt == null) opt = {};
			Object.keys(opt).map(key => obj[key] = opt[key])
			for (var p = 0; p < x._size[0]; p += 1) {
				obj['x'+(p+1)] = ox + x.subset(math.index(p));
				obj['y'+(p+1)] = oy - y.subset(math.index(p));
			}
			//$('canvas').drawLine(obj);
			return obj;
		}
		//console.log(math.abs(math.exp(math.multiply(math.i,kx1))));
		var period = 100;
		(function() {
			var timer;
			var mb = 1.0;
			$('div')
				.on('change','#zr',function(){
					mb = $('#zr').val() - 0;
				})
				.on('slidecreate','#zr',function(){
					mb = $('#zr').val() - 0;
				});
			var t = 0;
			function render() {
				var wt = math.chain(2)
					.multiply(math.pi)
					.divide(period)
					.multiply(t);
				var fw = math.chain(wt)
					.subtract(kx1)
					.cos()
					.multiply(50)
					.done();
				var bw = math.chain(wt)
					.add(kx1)
					.cos()
					.multiply(mb)
					.multiply(50)
					.done();
				var tw = math.chain(wt)
					.subtract(kx2)
					.cos()
					.multiply(math.add(mb,1))
					.multiply(50)
					.done();
				var sw = math.add(fw,bw);
				var ew = math.chain(
						math.add(
							math.exp(math.multiply(math.i,kx1))
							,
							math.chain(math.chain(-1).multiply(math.i).multiply(kx1).done())
								.exp()
								.multiply(mb)
								.done()
						)
					)
					.abs()
					.multiply(50)
					.done();
				/*
					math.cahin(math.e)
					.pow(math.chain(math.i).multiply(kx))
					.multiply(1)
					.done();
				*/
				$('canvas')
					.clearCanvas()
					.drawLine(lineObj(idx1,fw,210,150,{strokeStyle: '#00f'}))
					.drawLine(lineObj(idx1,bw,210,150,{strokeStyle: '#080'}))
					.drawLine(lineObj(idx1,sw,210,150,{strokeStyle: '#f00',strokeWidth: 2}))
					//.drawLine(lineObj(idx1,ew,210,100,{strokeStyle: '#f00',strokeDash: [10,3,5,3]}))
					.drawLine(lineObj(idx1,ew,210,150,{strokeStyle: '#f00',strokeDash: [5,3]}))
					.drawLine(lineObj(idx2,tw,210,150,{strokeStyle: '#f00',strokeWidth: 2}));
					/*
				$('canvas')
				.clearCanvas()
				.drawRect({
					strokeStyle: 'black',
					x:150+x, y:100,
					width:100,
					height:50
				});
				*/
				if (t > period) {
					t = 0;
				} else {
					t += 1;
				}
			}
			timer = setInterval(render, 17);
		})();
		
		/*
		angle = {
			degrees: 0,
			radians: 0,
			remainder: 0,
			max: 2880,
		};
		function mystep() {
			$('canvas')
				.clearCanvas()
				.drawRect({
					strokeStyle: 'black',
					x:50+angle.degrees, y:100,
					width:100,
					height:50
				});
		}
		$(angle)
		.stop()
		.animate({
			degrees: 150
		}, {
			duration: 5000,
			easing: 'linear',
			step: mystep
		});
		*/
		//console.log($('canvas').width());
		//console.log(math.pow(2,8));
		/*
		$('canvas').drawLine({
			strokeStyle: '#999999',
			x1: 0, y1: 0,
			x2: 100, y2: 180
		});
		*/
	</script>
</html>